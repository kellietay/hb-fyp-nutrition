{% extends 'base.html' %}
{% block content %}

<h1>Profile</h1>


<div>
    {% if 'userid' in session %}
        <h2> Welcome, {{ session['fname'] }}</h2>
        <input id="profileid" type="hidden" name="profileid" value={{ profileid }}>
        <br><br>
        {% if profiles is defined %}
        <h3>Profiles</h3>
            {% for profile in profiles %}
            <a href='/{{ session['userid'] }}/{{ profile.profile_id }}'>{{ profile.name }}'s Profile</div>
            {% endfor %}
        {% endif %}
        <a href='/profile/new-profile'> Create new profile </a>
        <br><br>
        <a href='/logout'> logout </a>
    {% else %}
        <a href='/login'> login </a>

    {% endif %}
</div>

<div>
    <form id="date-form">
        Date: <input type='date' name='date' id="inputdate">
        <input type='submit' id='submit'>
    </form>
        
</div>
<div id="profiletables">
<table>
    <tr>
        <th>Nutrient Name</th>
        <th>Reccomended Daily Value</th>
        <th>Today's Values</th>
    </tr>
    <tr>
        <td>Calories</td>
        <td>{{cal_obj.calories_modactive}}
        <td>{{total_nutrients['calories']}}</td>
    </tr>
    {%for item in nutrient_dict %}
        <tr>
            <td>{{ nutrient_dict[item] }}</td>
            <td>{{ ref_obj[item] }}</td>
            <td>{{ total_nutrients[item] }}</td>
        </tr>
    {% endfor %}
</table>

<div>
<h1>Foods eaten today</h1>
    <div id="button-nav">
    <table>
        <tr>
            <th>Food</th>
            <th>Quantity</th>
            <th>Unit </th>
            <th>Serving Weight (g)</th>
            <th></th>
        </tr>
    {%for item in rec_obj %}
        <tr id="food-table-{{item.record_id}}">
            <form id="food-form-{{item.record_id}}">
                <td>{{ item.food.food_name }}</td>
                <td><div id="food-form-quantity1-{{item.record_id}}" class="quantity">{{ item.serving_qty }}</div><div style="display: none;" id="food-form-quantity2-{{item.record_id}}" class="editquantity"><input type=text placeholder={{item.serving_qty}}></div></td>
                <td>{{ item.serving_unit }} </td>
                <td>{{ item.serving_weight_grams }}</td>
                <td>
                    <button id="food-form-button-edit-{{item.record_id}}" class="editbuttons" name="record_id" type="submit" value="{{item.record_id}}">Edit</button>
                    <button style="display: none;" id="food-form-button-submit-{{item.record_id}}" type="submit" value="{{item.record_id}}">Submit</button>
                    <button style="display: none;" id="food-form-button-cancel-{{item.record_id}}" type="submit" value="{{item.record_id}}">Cancel</button>

                </td>
            </form>
        </tr>
    {% endfor %}
    </table>
    </div>
    <form autocomplete="off" id="addfoodform">
        <div class="autocomplete" style="width:300px;">
            <input id="myInput" type="text" name="myCountry" placeholder="Search Foods">
            <input type="submit" id="addfoodsubmit" value="Add New Food">
        </div>
 
    </form>
    <input id="acList" type="hidden" name="acList" value="none">
</div>
</div>

<script src="/static/profile.js"></script>

{% endblock %}



<!-- <script>

function replaceTables(results){
    var status = results;
    $('#profiletables').html(status);
    console.log("Finished replaceTables");
}

function updateTables(evt){
    evt.preventDefault()
    const formData = {
            inputdate: $('#inputdate').val(),
            profileid: $('#profileid').val()
        }

    $.get("/profile/retrieve", formData, replaceTables);
    console.log("ran AJAX");
}

function initReload(){
    console.log("initReload is on");
    $('#date-form').on('submit', updateTables);
}

initReload();
console.log("please run");

</script> -->